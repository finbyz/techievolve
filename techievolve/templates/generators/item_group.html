{% extends "templates/web.html" %}

{% block header %}<h1>{{ name }}</h1>{% endblock %}

{% block page_content %}
<div class="item-group-content" itemscope itemtype="http://schema.org/Product">
    <div>
        {% if slideshow %}
        <!-- slideshow -->
        {% include "templates/includes/slideshow.html" %}
        {% endif %}
        {% if description %}
        <!-- description -->
        <div class="mb-3" itemprop="description">{{ description or ""}}</div>
        {% endif %}
    </div>
    <div class="row">
        <div class="col-md-12">
            {% if items %}
            <div id="search-list">
                <!-- For single table for multiple item -->
                {% set flag = namespace(a=1) %}

                {% for i in range(0, page_length) %}
                {% if items[i] %}
                {%- set item = items[i] %}
               
                {% if not item.item_group %}
                {% include "erpnext/www/all-products/item_row.html" %}
                {% else %}
               
                {% if loop.first %}
                {% set flag.a = 0 %}

                <table class="table table-bordered mt-3">
                    <thead>
                        <tr>
                            <th width="20%">{{ _('Image') }}</th>
                            <th width="35%">{{ _('Item') }}</th>
                            <th width="10%">{{ _('Price') }}</th>
                            <th width="10%">{{ _('Case Qty') }}</th>
                            <th width="15%" class="text-right">{{ _('Quantity') }}</th>
                            <th width="20%" class="text-right">{{ _('Subtotal') }}</th>
                        </tr>
                    </thead>
                    <tbody class="cart-items-custom">

                {% endif %}<!--  loop first end -->
                    
                {% include "templates/pages/item_cart.html" %}
                
                {% endif %}<!--  item group condition end -->
                
                {% endif %}
                {% if loop.last and flag.a == 0 %} 
                
                </tbody>
                </table>
                {% set flag.a = 1 %}
                {% endif %}

                {% endfor %}
            </div>
            <div class="mt-3" align="right">
                <!-- <a href="/cart" class="btn btn-light btn-view-in-cart" role="button">
                    {{ _("View in Cart") }}
                </a> -->
                <button
                    class="btn btn-outline-primary btn-add-to-cart">
                    {{ _("Add to Cart") }}
                </button>
            </div>
            <div class="clearfix"></div>
            <div class="item-group-nav-buttons">
                {% if frappe.form_dict.start|int > 0 %}
                <a class="btn btn-outline-secondary"
                    href="/{{ pathname }}?start={{ frappe.form_dict.start|int - page_length }}">{{ _("Prev") }}</a>
                {% endif %}
                {% if items|length > page_length %}
                <a class="btn btn-outline-secondary"
                    href="/{{ pathname }}?start={{ frappe.form_dict.start|int + page_length }}">{{ _("Next") }}</a>
                {% endif %}
            </div>
            {% else %}
            <div class="text-muted">{{ _("No items listed") }}.</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    frappe.ready(() => {
        $('.page_content').on('click', '.btn-add-to-cart', (e) => {
            const $btn = $(e.currentTarget);
            
            $btn.prop('disabled', true);

           
           
    
            item_list = [{'item_code':'99464GL','qty':5}]
            //$('.cart-items-custom tr').each(function () {
              // item_code_list.push(($(this).find("td:first").attr("data-item-code")));
            //});
            //console.log(item_code_list)
            frappe.call({
                'method': "techievolve.api.update_cart_custom",
                'args':{
                    'item_data': item_list
                },
                'callback': function (r){
                    console.log('custom call')
                }
            })
                    
        });
    });
</script>
{% endblock %}
